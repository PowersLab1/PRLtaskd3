(this.webpackJsonpprltaskd3=this.webpackJsonpprltaskd3||[]).push([[0],{106:function(t,e,a){"use strict";a.r(e),a.d(e,"history",(function(){return w}));var n=a(0),s=a.n(n),o=a(44),r=a.n(o),i=a(1),c=a(22);const d=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(92),a(93);const l=a(42);var u=a(94),h=a(95);a(100);class p extends n.Component{constructor(t){console.log("LabJsWrapperconstructor"),super(t);const e=h.parse(this.props.location.search,{ignoreQueryPrefix:!0});this.surveyUrl=e.survey_url,this.state={encryptedMetadata:e.id,sendingData:!1,link:void 0},u.isUndefined(this.state.encryptedMetadata)||this.addScript("/PRLtaskd3/external/lab.js",()=>{this.addScript("/PRLtaskd3/script.js")})}packageDataForExport(t){const e={};return console.log("packageDataForExport"),console.log(t),e.encrypted_metadata=this.state.encryptedMetadata,e.taskName=l.taskName,e.taskVersion=l.taskVersion,e.data=this.processLabJsData(t),JSON.stringify(e)}processLabJsData(t){return t}componentDidMount(){console.log("in componentdidmount");var t=this;window.addEventListener("message",(function(e){if("labjs.data"===e.data.type){const a=JSON.parse(e.data.json);if(d)return void(t.surveyUrl&&(console.log("in that.surveyUrl"),t.setState({link:t.surveyUrl})));t.setState({sendingData:!0}),t.saveTaskDataWithRetry(a,2)}}))}saveTaskDataWithRetry(t,e){const a=this;console.log("new saveTaskData called"),Object(c.b)(a.state.encryptedMetadata,a.packageDataForExport(t)).then(()=>{a.handleDataSaveSuccess()}).catch(n=>{e>1?setTimeout(()=>{console.log("Retrying to save task data..."),a.saveTaskDataWithRetry(t,e-1)},1e3):console.error("Failed to save task data after retries:",n)})}handleDataSaveSuccess(){this.surveyUrl?this.setState({link:this.surveyUrl}):Object(c.a)(this.state.encryptedMetadata).then(t=>this.setState({link:t}))}addScript(t,e){const a=document.createElement("script");a.src=t,a.type="module",a.onreadystatechange=e,a.onload=e,document.head.appendChild(a)}render(){return u.isUndefined(this.state.encryptedMetadata)?s.a.createElement("div",null,s.a.createElement("h2",null,"Something went wrong. Please try again.")):(u.isUndefined(this.state.link)||window.location.assign(this.state.link),s.a.createElement("div",null,s.a.createElement("div",{className:"container fullscreen","data-labjs-section":"main",style:{visibility:this.state.sendingData?"hidden":"visible"}},s.a.createElement("main",{className:"content-vertical-center content-horizontal-center"})),s.a.createElement("div",{className:"center",style:{visibility:this.state.sendingData?"visible":"hidden"}},s.a.createElement("h2",null,"Saving data... do not exit window"))))}}var m=p,f=()=>s.a.createElement(i.c,null,s.a.createElement(i.a,{path:"/",exact:!0,component:m}));class g extends n.Component{render(){return s.a.createElement("div",null,s.a.createElement(f,null))}}var v=g,y=a(21),k=a(3);const w=Object(k.a)();console.log("render react"),r.a.render(s.a.createElement(y.a,{history:w,basename:"/PRLtaskd3"},s.a.createElement(v,null)),document.getElementById("root"))},22:function(t,e,a){"use strict";(function(t){a.d(e,"b",(function(){return r})),a.d(e,"a",(function(){return i}));var n=a(53),s=a(89);const o=a(42);function r(e,a){return new Promise((function(r,i){const c=s.stringify({encrypted_metadata:e,data:a}),d={hostname:o.awsLambda.saveTaskData.host,port:443,path:o.awsLambda.saveTaskData.path,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":t.byteLength(c)}},l=n.request(d,t=>{t.setEncoding("utf8"),t.on("data",()=>{}),t.on("end",r)});l.on("error",t=>{o.debug&&(console.log("ERROR:"),console.log(t)),i(t)}),l.write(c),l.end()}))}function i(e){return new Promise((function(a,r){const i=s.stringify({encrypted_metadata:e}),c={hostname:o.awsLambda.fetchLink.host,port:443,path:o.awsLambda.fetchLink.path,method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","Content-Length":t.byteLength(i)}},d=n.request(c,t=>{t.setEncoding("utf8");var e="";t.on("data",(function(t){e+=t})),t.on("end",()=>a(e))});d.on("error",t=>{o.debug&&(console.log("ERROR:"),console.log(t)),r(t)}),d.write(i),d.end()}))}}).call(this,a(7).Buffer)},42:function(t){t.exports=JSON.parse('{"taskVersion":"1.0.0","taskName":"prltaskd3","debug":false,"awsLambda":{"saveTaskData":{"host":"de8cnjde61.execute-api.us-east-2.amazonaws.com","path":"/default/saveTaskData"},"fetchLink":{"host":"3pnzb6n9vf.execute-api.us-east-2.amazonaws.com","path":"/default/fetchLink"}}}')},46:function(t,e,a){t.exports=a(106)},56:function(t,e){},58:function(t,e){},87:function(t,e){},92:function(t,e,a){},93:function(t,e,a){}},[[46,1,2]]]);
//# sourceMappingURL=main.4df416f1.chunk.js.map